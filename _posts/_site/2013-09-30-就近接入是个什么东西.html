<h2 id='id28'>一个比喻</h2>

<p>我住的旁边有一个沃尔玛, 每个星期我都会去一两次沃尔玛买一些日常的用品, 沃尔玛齐全的商品是小超市无法比的, 需要买的东西几乎都会有. 沃尔玛在深圳有12个店, 这些店分布在深圳的各处. 沃尔玛为什么要在深圳开设12家店, 是不是开设一家就足够了呢? 答案显而易见, 开一家店只能招揽附近的消费者, 其他地方的消费者会由于距离太远而选择其他的超市. 将店开设在距离消费者较近的地方, 消费者可以根据自己的情况选择距离自己较近的店进行购物, 这样可以最大限度的招揽到消费者.</p>

<p>沃尔玛付出了什么代价: 增加了更多的成本, 包括人力,物力,财力等 沃尔玛获得了什么好处: 获得了更多的消费者, 更多的消费者认知度, 更多的销售.</p>

<p>一个互联网服务和沃尔玛超市一样, 当你只将超市开设在某一个地方时, 相较于距离较远的消费者, 距离超市近的消费者就会常常去. 互联网服务也一样, 访问较快的用户会感觉很好,很有可能会继续使用甚至会推荐给朋友, 访问较慢的用户就会感到厌烦, 很大可能会放弃使用甚至会建议朋友不要用. 所以为提高用户访问互联网服务的速度, 在不同地区部署相同的互联网服务在现在是一种通用的做法. 你在不同的地区部署了相同的互联网服务, 如何让用户知道这些服务, 并根据用户自身情况访问质量最好位置的服务, 就是就近接入所要解决的问题. 在生活中就近接入像114查询服务,你可以询问获得附近的旅店,餐馆…. 在互联网中就近接入更像dns服务器, 不过就近接入更加特化, 有更多的业务属性. 在互联网中就近接入为什么重要, 如果你了解DNSPod 的发展历史和现在的业务, 我想你会明白. 如果你不了解可以谷歌一下.</p>

<h2 id='id29'>就近接入是什么</h2>

<p>我想通过上面的比喻说明我想大家都对就近接入有了一定的认识. 就近接入就是根据用户情况, 告诉用户访问哪里的服务更快更爽的服务.</p>

<h3 id='id30'>当前都有些什么互联网服务会用到这个服务?</h3>

<p>在线视频: 在线视频由于需要传输很大的视频文件, 所以让用户连接到一个”近”的服务器, 将会对视频播放的流畅度有很大的提升, 从而带来的优势也是可以感受到的. 和在线视频相同性质的还会有音频或者图片服务等. 移动互联网: 由于移动网络的特殊性, 这些特殊性你需要去了解一下中国的无线网络环境. 当你读懂了”世界最远的距离不是天涯海角, 而是我在移动, 你在移动”, 你就会认识到这点.</p>

<h2 id='_'>有哪些设计点 ?</h2>

<p>让我们再来看看就近接入是干什么的: 就近接入就是根据用户情况, 告诉用户访问哪里的服务更快更爽的服务. 在这个描述中涉及到的角色包括: 用户, 服务, 就近接入. 就近接入: 作为用户访问服务的中间角色, 就近接入需要知道用户和服务的信息.</p>

<h3 id='id31'>那到底需要知道哪些信息呢?</h3>

<p>对于用户, 就近接入需要知道的能够定位一个用户当前所在位置(北京, 深圳, …), 当前网络(联通, 移动, …, 2G, 3G, Wifi) 的信息. 对于服务, 就近接入需要知道这些服务部署在哪些地方(北京, 深圳, …), 这些服务当前的状况(拥塞, 死机, 良好… ) 就近接入知道用户和服务的信息后, 剩下的就是下发策略, 也就是对不同的用户应该下发哪个服务的地址让其访问. 这里需要考虑很多东西, 比如下发数量, 访问优先级, 容错等.</p>

<h3 id='id32'>用户位置的获取</h3>

<p>在这里, 还涉及到一个重要的东西, 就是用户给你的信息不回直接指出他在哪里(深圳, 北京,…), 当然你也可以通过gps, 但是这个几乎是不可能的. 最直接的方式是通过用户的ip, 当用户使用2G或3G网络时, 用户都会分配得一个运营商的ip 地址, 这些ip地址都是分地区的, 使用这个ip你就可以确定用户的位置了? 当然不是, 你还需要一个健全的各个运营商拥有的ip和地理位置的对应关系 这样你才能通过用户 ip 确定用户的位置.</p>

<p>用户的网络类型, 这个你可以通过前端带到就近接入, 也可以通过你的 ip 库查询获得.</p>

<h3 id='id33'>服务的位置及当前状态</h3>

<p>服务的位置, 这个是服务的运维人员部署的, 如何更好地部署这些服务也会是一个很大的问题(就如沃尔玛的选址, 他们不会在同一个地点开设2家一样的超市, 也不会在人少交通不便的地方开设超市). 不好的部署方式, 即使使用就近接入也无济于事. 服务的当前状态, 这也是就近接入的一个重要依据, 不能让一个用户去一个拥塞或死机了的服务处访问(就如不能去一个拥挤或关门了的沃尔玛买东西一样, 去了只能是shit了).</p>

<h2 id='id34'>扩展</h2>

<p>上面只是对就近接入的一个大概描述, 其中涉及到的很多细节并未提及, 比如说如何知道服务的状态, 如何获得ip库, 如何ip容错, 如何确定用户访问速度等等, 这些都需要实现者去考虑, 这里只说了就近接入的一个部分, 利用就近接入所处的位置, 还可以有很多其他功能, 比如说用户测速, 用户环境切换等&#8230;</p>